<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Passes · OhMyREPL</title><meta name="title" content="Passes · OhMyREPL"/><meta property="og:title" content="Passes · OhMyREPL"/><meta property="twitter:title" content="Passes · OhMyREPL"/><meta name="description" content="Documentation for OhMyREPL."/><meta property="og:description" content="Documentation for OhMyREPL."/><meta property="twitter:description" content="Documentation for OhMyREPL."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OhMyREPL</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><span class="tocitem">Features</span><ul><li><a class="tocitem" href="../../features/syntax_highlighting/">Syntax highlighting</a></li><li><a class="tocitem" href="../../features/bracket_highlighting/">Bracket highlighting</a></li><li><a class="tocitem" href="../../features/bracket_complete/">Bracket completion</a></li><li><a class="tocitem" href="../../features/prompt/">Prompt changing</a></li><li><a class="tocitem" href="../../features/rainbow_brackets/">Rainbow Brackets</a></li><li><a class="tocitem" href="../../features/markdown_highlight/">Markdown Syntax Highlighting</a></li><li><a class="tocitem" href="../../features/fzf/">Fuzzy REPL history search</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li class="is-active"><a class="tocitem" href>Passes</a><ul class="internal"><li><a class="tocitem" href="#How-a-pass-works"><span>How a pass works</span></a></li><li><a class="tocitem" href="#Creating-a-pass"><span>Creating a pass</span></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Internals</a></li><li class="is-active"><a href>Passes</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Passes</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/KristofferC/OhMyREPL.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/KristofferC/OhMyREPL.jl/blob/master/docs/src/internals/passes.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Passes"><a class="docs-heading-anchor" href="#Passes">Passes</a><a id="Passes-1"></a><a class="docs-heading-anchor-permalink" href="#Passes" title="Permalink"></a></h1><p>In <code>OhMyREPL</code> each plugin that changes the way text is printed to the REPL is implemented as a <strong>pass</strong>. A <strong>pass</strong> is defined as a function (or a call overloaded type) that takes a list of Julia tokens from <a href="https://github.com/JuliaLang/JuliaSyntax.jl"><code>JuliaSyntax.jl</code></a>, a list of <code>Crayon</code>s from <a href="https://github.com/KristofferC/Crayons.jl"><code>Crayons.jl</code></a>, the position of the cursor and sets the <code>Crayon</code>s to however the pass wants the Julia tokens to be printed. Both the <a href="../../features/syntax_highlighting/#Syntax-highlighting">Syntax highlighting</a> and the <a href="../../features/bracket_highlighting/#Bracket-highlighting">Bracket highlighting</a> are implemented as passses.</p><p>All the passes are registered in a global pass handler. To show all the passes use <code>OhMyREPL.showpasses()</code>:</p><pre><code class="language-julia-repl hljs">julia&gt; OhMyREPL.showpasses()
----------------------------------
 #   Pass name             Enabled
----------------------------------
 1   BracketHighlighter    true
 2   SyntaxHighlighter     true
----------------------------------</code></pre><p>A pass can be enabled or disabled at will with <code>OhMyREPL.enable_pass!(pass_name::String, enabled::Bool)</code>. As an example, we disable the syntax highlighting:</p><p><img src="../disable_highlight.png" alt/></p><h2 id="How-a-pass-works"><a class="docs-heading-anchor" href="#How-a-pass-works">How a pass works</a><a id="How-a-pass-works-1"></a><a class="docs-heading-anchor-permalink" href="#How-a-pass-works" title="Permalink"></a></h2><p>This section shows how text from the REPL get transformed into syntax highlighted text. The sample text used is:</p><pre><code class="language-julia hljs">str = &quot;function f(x::Float64) return :x + &#39;a&#39; end&quot;</code></pre><p>First the text is tokenized with <a href="https://github.com/JuliaLang/JuliaSyntax.jl"><code>JuliaSyntax.jl</code></a>:</p><pre><code class="language-julia-repl hljs">julia&gt; using JuliaSyntax

julia&gt; tokens = JuliaSyntax.tokenize(str)
21-element Vector{JuliaSyntax.Token}:
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;function&quot;, 0x0001), 0x00000001:0x00000008)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Whitespace&quot;, 0x0001), 0x00000009:0x00000009)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Identifier&quot;, 0x0000), 0x0000000a:0x0000000a)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;(&quot;, 0x0001), 0x0000000b:0x0000000b)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Identifier&quot;, 0x0000), 0x0000000c:0x0000000c)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;::&quot;, 0x0001), 0x0000000d:0x0000000e)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Identifier&quot;, 0x0000), 0x0000000f:0x00000015)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;)&quot;, 0x0001), 0x00000016:0x00000016)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Whitespace&quot;, 0x0001), 0x00000017:0x00000017)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;return&quot;, 0x0001), 0x00000018:0x0000001d)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Whitespace&quot;, 0x0001), 0x0000001e:0x0000001e)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;:&quot;, 0x0001), 0x0000001f:0x0000001f)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Identifier&quot;, 0x0000), 0x00000020:0x00000020)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Whitespace&quot;, 0x0001), 0x00000021:0x00000021)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;+&quot;, 0x0000), 0x00000022:0x00000022)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Whitespace&quot;, 0x0001), 0x00000023:0x00000023)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;&#39;&quot;, 0x0001), 0x00000024:0x00000024)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Char&quot;, 0x0000), 0x00000025:0x00000025)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;&#39;&quot;, 0x0001), 0x00000026:0x00000026)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;Whitespace&quot;, 0x0001), 0x00000027:0x00000027)
 JuliaSyntax.Token(JuliaSyntax.SyntaxHead(K&quot;end&quot;, 0x0001), 0x00000028:0x0000002a)</code></pre><p>A vector of <code>Crayon</code>s of the same length as the Julia tokens is then created and filled  with empty tokens.</p><pre><code class="language-julia hljs">crayons = Vector{Crayon}(length(tokens));
fill!(crayons, Crayon()) # Crayon is a bits type so this is OK</code></pre><p>These two vectors and the source code are then sent to the syntax highlighter pass together with an integer that represent what character offset the cursor currently is located. The syntax highlighter does not use this information but the bracket highlighter does.</p><pre><code class="language-julia hljs">OhMyREPL.Passes.SyntaxHighlighter.SYNTAX_HIGHLIGHTER_SETTINGS(crayons, tokens, 0, str)</code></pre><p>Running this function has the effect of updating the <code>crayons</code> vector. If we print this vector we see that they have been updated:</p><p><img src="../ansitokens_after.png" alt/></p><p>To print the original string with the updated vector of <code>Crayon</code>s we use the <code>OhMyREPL.untokenize_with_ANSI([io::IO], crayons, tokens, str)</code> function as:</p><p><img src="../print_ansi.png" alt/></p><p>Each registered and enabled pass does this updating and the contributions from each pass to the <code>Crayon</code> vector is merged in to a separate vector. After each pass is done, the result is printed to the REPL.</p><h2 id="Creating-a-pass"><a class="docs-heading-anchor" href="#Creating-a-pass">Creating a pass</a><a id="Creating-a-pass-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-a-pass" title="Permalink"></a></h2><p>This section shows how to create a pass that let the user define a <code>Crayon</code> for each typeassertion / declaration that happens to be a <code>Float64</code>.</p><div class="admonition is-info" id="Info-349057ca665cbb9b"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-349057ca665cbb9b" title="Permalink"></a></header><div class="admonition-body"><p>Please refer to the <a href="https://github.com/JuliaLang/JuliaSyntax.jl">JuliaSyntax.jl API</a> and the  <a href="https://github.com/KristofferC/Crayons.jl"><code>Crayons.jl</code> documentation</a> while reading this section.</p></div></div><p>We start off with a few imports and creating a new struct which will hold the setting for the pass:</p><pre><code class="language-julia hljs">using Crayons
import JuliaSyntax
import JuliaSyntax: Token, untokenize, kind
using OhMyREPL

mutable struct Float64Modifier
    crayon::Crayon
end

# Default it the underlined red:
const FLOAT64_MODIFIER = Float64Modifier(Crayon(foreground = :red, underline= true))</code></pre><p>We then use call overloading to define a function for the type. The function will update the <code>Crayon</code> if the previous token was a <code>::</code> operator and that the current token is a <code>Float64</code> identifier, as in <code>::Float64</code>.</p><pre><code class="language-julia hljs"># The pass function, the cursor position is not used but it needs to be given an argument
function (float64modifier::Float64Modifier)(crayons::Vector{Crayon}, tokens::Vector{Token}, cursorpos::Int, str::AbstractString)
    # Loop over all tokens and crayons
    for i in 1:length(crayons)
        if untokenize(tokens[i], str) == &quot;Float64&quot;
            if i &gt; 1 &amp;&amp; kind(tokens[i-1]) == JuliaSyntax.K&quot;::&quot;
                # Update the crayon
                crayons[i] = float64modifier.crayon
            end
        end
    end
end</code></pre><h3 id="Testing-the-pass"><a class="docs-heading-anchor" href="#Testing-the-pass">Testing the pass</a><a id="Testing-the-pass-1"></a><a class="docs-heading-anchor-permalink" href="#Testing-the-pass" title="Permalink"></a></h3><p>A pass can be tested with the <code>OhMyREPL.test_pass([io::IO], pass, str::String)</code> where <code>str</code> is a test string to test the pass on:</p><p><img src="../test_pass.png" alt/></p><h3 id="Register-the-pass"><a class="docs-heading-anchor" href="#Register-the-pass">Register the pass</a><a id="Register-the-pass-1"></a><a class="docs-heading-anchor-permalink" href="#Register-the-pass" title="Permalink"></a></h3><p>To register and start using the pass simply use <code>OhMyREPL.add_pass!(passname::String, pass)</code>:</p><pre><code class="language-julia-repl hljs">julia&gt; OhMyREPL.add_pass!(&quot;Redify Float64&quot;, FLOAT64_MODIFIER)
----------------------------------
 #   Pass name             Enabled
----------------------------------
 1   Redify Float64        true
 2   BracketHighlighter    true
 3   SyntaxHighlighter     true
----------------------------------</code></pre><p>We can now try it out together with the other passes by writing some syntax that includes <code>::Float64</code>:</p><p><img src="../using_pass.png" alt/></p><h3 id="Modify-prescedence-of-registered-passes"><a class="docs-heading-anchor" href="#Modify-prescedence-of-registered-passes">Modify prescedence of registered passes</a><a id="Modify-prescedence-of-registered-passes-1"></a><a class="docs-heading-anchor-permalink" href="#Modify-prescedence-of-registered-passes" title="Permalink"></a></h3><p>We actually have a conflict now because both the syntax highlighter and the newly added pass will try to modify the properties of the printed <code>Float64</code> token. This is where the <strong>prescedence</strong> of each pass come in. The order of each pass is executed from bottom up in the list given by <code>OhMyREPL.show_passes()</code>. As can be see above, the new pass has the highest prescedence which is why the color of <code>Float64</code> is actually red.</p><p>The prescedence of a pass can be modified with the <code>OhMyREPL.prescedence!(pass::Union{String, Int}, prescedence::Int)</code>. The variable <code>pass</code> here is either the name of the pass or its number as given by <code>OhMyREPL.show_passes()</code>. We now set the prescedence of the new pass to 3:</p><pre><code class="language-julia-repl hljs">julia&gt; OhMyREPL.prescedence!(&quot;Redify Float64&quot;, 3)
----------------------------------
 #   Pass name             Enabled
----------------------------------
 1   BracketHighlighter    true
 2   SyntaxHighlighter     true
 3   Redify Float64        true
----------------------------------</code></pre><p>Rewriting the same string in the REPL as above we now get:</p><p><img src="../lower_presc.png" alt/></p><p>The foreground color of <code>Float64</code> is now determined by the Syntax highlighter pass. Note that the syntax highlighter does not touch the underlining so that one is still kept from the new pass.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../features/fzf/">« Fuzzy REPL history search</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 14 October 2025 19:00">Tuesday 14 October 2025</span>. Using Julia version 1.12.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
